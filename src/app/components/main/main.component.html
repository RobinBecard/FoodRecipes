<div class="blur-background"></div>
<div class="global-container">
  <button class="menu-button" (click)="toggleSidebar()">â˜°</button>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar" [class.open]="isSidebarOpen">
      <div class="sidebar-background"></div>
      <div class="sidebar-list">
        <div class="MyList-header">
          <h2 class="sidebar-title"><mat-icon>list</mat-icon> My Lists</h2>
          <button class="MyListButton" mat-icon-button color="primary" (click)="addList()">
            <mat-icon id="MyList-AddButton">add</mat-icon>
          </button>
        </div>
        <div class="sidebar-list-container">
          <!-- Content for My List -->
          <div class="sidebar-card" *ngFor="let list of ingredientsList">
            <div class="sidebar-recipe-name">{{ list.name }}</div>
            <div class="sidebar-recipe-attributs">
              <div>{{ list.ingredients.length }} ingredients</div>
            </div>
            <div><button (click)="editList(list.id)">modifier</button></div>
          </div>
        </div>
      </div>
      <div class="sidebar-list">
        <h2 class="sidebar-title">
          <mat-icon>favorite</mat-icon> My Favorites
        </h2>
        <div class="favorites-container">
          <div class="sidebar-card" *ngFor="let recipe of favoriteRecipesList">
            <div class="sidebar-recipe-name">{{ recipe.strMeal }}</div>
            <div class="sidebar-recipe-attributs">
              <div>{{ recipe.strCategory }}</div>
              <div>{{ recipe.strArea }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <div class="title-part">
          <div class="title-div">
            <h1 class="page-title">Find a new recipe</h1>
          </div>
          <app-bottom-bar></app-bottom-bar>
        </div>
        <div class="buttons-container">
          <button mat-raised-button color="primary" (click)="resetFilters()">
            <mat-icon>refresh</mat-icon> Reset Filters
          </button>
          <button
            mat-raised-button
            color="accent"
            (click)="loadRandomMeals(15)"
            class="random-button"
          >
            <mat-icon>shuffle</mat-icon> Random Recipe
          </button>
        </div>
      </div>

      <!-- Filtres -->
      <div class="filters-container">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Search by recipe name</mat-label>
          <input
            matInput
            type="text"
            [formControl]="searchControl"
            placeholder="Enter recipe name..."
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select [formControl]="selectedCategory">
            <mat-option [value]="">All Categories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" >
          <mat-label>Region</mat-label>
          <mat-select [formControl]="selectedRegion">
            <mat-option [value]="">All Regions</mat-option>
            <mat-option *ngFor="let region of regions" [value]="region">
              {{ region }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Ingredients</mat-label>
          <mat-select [formControl]="selectedIngredientsList">
            <mat-option [value]="">No List</mat-option>
            <mat-option
              *ngFor="let ingredient of ingredientsList"
              [value]="ingredient.name"
            >
              {{ ingredient.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div class="alphabet-filter">
          <span id="text-filter">Filter by first letter:</span>
          <div class="letter-container">
            <mat-chip-option
              *ngFor="let letter of alphabet"
              [value]="letter"
              (click)="selectedLetter.setValue(letter)"
              [selected]="selectedLetter.value === letter"
            >
              {{ letter }}
            </mat-chip-option>

          </div>
        </div>
      </div>

      <!-- No results message -->
      <div class="no-results" *ngIf="!isLoading && RecipesList.length === 0">
        <mat-icon>search_off</mat-icon>
        <p>
          No recipes found matching your criteria. Try changing your filters.
        </p>
      </div>

      <!-- Recipes Grid -->
      <div
        class="recipe-grid"
      >
        @for (recipe of RecipesList; track recipe.idMeal) {
          <app-simplified-card
            [recipe]="recipe"
            displayType="main"
            (click)="openDescriptionDialog(recipe.idMeal)"
          >
          </app-simplified-card>
        }
      </div>
    </div>
  </div>
</div>